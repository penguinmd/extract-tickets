{% extends "base.html" %}

{% block title %}Analysis - Compensation Analysis{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-chart-bar"></i> Analysis & Insights
        </h1>
    </div>
</div>

<!-- Analysis Charts -->
<div class="row">
    <div class="col-lg-6">
        <div class="card chart-container">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line"></i> Income Trend
                </h5>
            </div>
            <div class="card-body">
                <img src="{{ url_for('static', filename='reports/income_trend.png') }}?v={{ range(1, 1000) | random }}" 
                     class="img-fluid" alt="Income Trend" 
                     onerror="this.parentElement.innerHTML='<div class=\'text-center text-muted\'><i class=\'fas fa-exclamation-triangle fa-2x mb-2\'></i><br>Chart not available</div>'">
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card chart-container">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-alt"></i> Seasonal Trends
                </h5>
            </div>
            <div class="card-body">
                <img src="{{ url_for('static', filename='reports/seasonal_trends.png') }}?v={{ range(1, 1000) | random }}" 
                     class="img-fluid" alt="Seasonal Trends"
                     onerror="this.parentElement.innerHTML='<div class=\'text-center text-muted\'><i class=\'fas fa-exclamation-triangle fa-2x mb-2\'></i><br>Chart not available</div>'">
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card chart-container">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-procedures"></i> Procedure Profitability
                </h5>
            </div>
            <div class="card-body">
                <img src="{{ url_for('static', filename='reports/procedure_profitability.png') }}?v={{ range(1, 1000) | random }}" 
                     class="img-fluid" alt="Procedure Profitability"
                     onerror="this.parentElement.innerHTML='<div class=\'text-center text-muted\'><i class=\'fas fa-exclamation-triangle fa-2x mb-2\'></i><br>Chart not available</div>'">
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card chart-container">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-building"></i> Payer Performance
                </h5>
            </div>
            <div class="card-body">
                <img src="{{ url_for('static', filename='reports/payer_performance.png') }}?v={{ range(1, 1000) | random }}" 
                     class="img-fluid" alt="Payer Performance"
                     onerror="this.parentElement.innerHTML='<div class=\'text-center text-muted\'><i class=\'fas fa-exclamation-triangle fa-2x mb-2\'></i><br>Chart not available</div>'">
            </div>
        </div>
    </div>
</div>

<!-- Analysis Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tools"></i> Analysis Tools
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-sync-alt fa-2x text-primary mb-2"></i>
                            <h6>Refresh Charts</h6>
                            <p class="text-muted small">Update all charts with latest data</p>
                            <button class="btn btn-primary btn-sm" onclick="refreshCharts()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-download fa-2x text-success mb-2"></i>
                            <h6>Export Data</h6>
                            <p class="text-muted small">Download analysis data as CSV</p>
                            <button class="btn btn-success btn-sm" onclick="exportData()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-print fa-2x text-info mb-2"></i>
                            <h6>Print Report</h6>
                            <p class="text-muted small">Print analysis charts and data</p>
                            <button class="btn btn-info btn-sm" onclick="window.print()">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Key Insights -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb"></i> Key Insights
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-chart-line text-success"></i> Income Trends</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Track monthly gross pay over time</li>
                            <li><i class="fas fa-check text-success"></i> Identify growth patterns and trends</li>
                            <li><i class="fas fa-check text-success"></i> Compare performance across periods</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-calendar text-info"></i> Seasonal Analysis</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-info"></i> Understand seasonal variations</li>
                            <li><i class="fas fa-check text-info"></i> Plan for busy and slow periods</li>
                            <li><i class="fas fa-check text-info"></i> Optimize scheduling and resources</li>
                        </ul>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-procedures text-warning"></i> Procedure Analysis</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-warning"></i> Most profitable procedure types</li>
                            <li><i class="fas fa-check text-warning"></i> Frequency of different CPT codes</li>
                            <li><i class="fas fa-check text-warning"></i> Average billing per procedure</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-building text-danger"></i> Payer Performance</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-danger"></i> Insurance carrier payment patterns</li>
                            <li><i class="fas fa-check text-danger"></i> Average payment per carrier</li>
                            <li><i class="fas fa-check text-danger"></i> Total volume by payer type</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function refreshCharts() {
    // Show loading indicator
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
    button.disabled = true;
    
    // Reload the page to regenerate charts
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

function exportData() {
    // This would typically trigger a download endpoint
    alert('Export functionality would be implemented here to download CSV data.');
}

// Print styles
window.addEventListener('beforeprint', function() {
    document.body.classList.add('printing');
});

window.addEventListener('afterprint', function() {
    document.body.classList.remove('printing');
});
</script>

<style>
@media print {
    .navbar, .card-header, .btn, .alert {
        display: none !important;
    }
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    .chart-container img {
        max-width: 100% !important;
        height: auto !important;
    }
}
</style>
{% endblock %}